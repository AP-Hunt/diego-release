From 84af8c54d47ce2c470120324f963e0f0f9837195 Mon Sep 17 00:00:00 2001
From: Brandon Shroyer <bshroyer@pivotal.io>
Date: Mon, 23 Jan 2017 12:24:41 -0500
Subject: [PATCH] Add TLS credentials to bbs-auctioneer communication.

---
 cf-deployment.yml | 28 ++++++++++++++++++++++++++++
 1 file changed, 28 insertions(+)

diff --git a/cf-deployment.yml b/cf-deployment.yml
index 8f610d5..674f2f6 100644
--- a/cf-deployment.yml
+++ b/cf-deployment.yml
@@ -288,6 +288,10 @@ instance_groups:
             ca_cert: nil
             client_cert: nil
             client_key: nil
+          auctioneer: &diego_auctioneer_client_properties
+            ca_cert: "((diego_auctioneer.ca))"
+            client_cert: "((diego_auctioneer.client.certificate))"
+            client_key: "((diego_auctioneer.client.private_key))"
           ca_cert: "((diego_bbs.ca))"
           server_cert: "((diego_bbs_server.certificate))"
           server_key: "((diego_bbs_server.private_key))"
@@ -491,6 +495,9 @@ instance_groups:
       diego:
         auctioneer:
           bbs: *diego_bbs_client_properties
+          ca_cert: "((diego_auctioneer.ca))"
+          server_cert: "((diego_auctioneer.server.certificate))"
+          server_key: "((diego_auctioneer.server.private_key))"
   - name: metron_agent
     release: loggregator
     properties: *metron_agent_properties
@@ -1358,6 +1365,27 @@ variables:
     ext_key_usage:
     - client_auth
     - server_auth
+- name: diego_auctioneer
+  type: certificate
+  options:
+    common_name: auctioneerCA
+- name: diego_auctioneer_client
+  type: certificate
+  options:
+    ca: diego_auctioneer
+    common_name: auctioneer client
+    ext_key_usage:
+    - client_auth
+- name: diego_auctioneer_server
+  type: certificate
+  options:
+    ca: diego_auctioneer
+    common_name: auctioneer.service.cf.internal
+    ext_key_usage:
+    - server_auth
+    alternative_names:
+    - "*.auctioneer.service.cf.internal"
+    - auctioneer.service.cf.internal
 - name: diego_bbs
   type: certificate
   options:
-- 
2.9.2

