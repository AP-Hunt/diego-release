#!/bin/bash -e

RUN_DIR=/var/vcap/sys/run/auctioneer
LOG_DIR=/var/vcap/sys/log/auctioneer
MONIT_LOG_DIR=/var/vcap/sys/log/monit
CONF_DIR=/var/vcap/jobs/auctioneer/config

source /var/vcap/packages/pid_utils/pid_utils.sh

function create_directories_and_chown_to_vcap() {
  mkdir -p ${RUN_DIR}
  chown -R vcap:vcap ${RUN_DIR}

  mkdir -p ${LOG_DIR}
  chown -R vcap:vcap ${LOG_DIR}

  mkdir -p $MONIT_LOG_DIR
  chown -R vcap:vcap $MONIT_LOG_DIR

  mkdir -p "${CONF_DIR}"
  chown -R vcap:vcap "${CONF_DIR}"
}

function set_open_file_descriptors() {
	# Allowed number of open file descriptors
  ulimit -n 100000
}

function set_pidguard() {
	pid_guard ${PIDFILE} "auctioneer"
}

function setup() {
  create_directories_and_chown_to_vcap
  set_open_file_descriptors
  set_pidguard
}

setup
